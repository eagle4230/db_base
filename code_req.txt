1. Найдите потоки, количество учеников в которых больше или равно 40. В отчет выведите номер потока, название курса и количество учеников.

SELECT
	number AS number_stream,
	(SELECT name FROM courses WHERE courses.id = streams.course_id) AS course_name,
	student_amount 
FROM streams WHERE student_amount >= 40;

2. Найдите два потока с самыми низкими значениями успеваемости. В отчет выведите номер потока, название курса, фамилию и имя преподавателя (одним столбцом), оценку успеваемости.

SELECT
	(SELECT number FROM streams WHERE streams.id = grades.stream_id) AS number_stream,
	(SELECT name FROM courses WHERE id = 
	(SELECT course_id FROM streams WHERE id = stream_id)) AS course_name,
	(SELECT name ||' '|| surname FROM teachers WHERE teachers.id = grades.teacher_id) AS teacher,
	grade
FROM grades ORDER BY grade LIMIT 2;

3. Найдите среднюю успеваемость всех потоков преподавателя Николая Савельева. В отчёт выведите идентификатор преподавателя и среднюю оценку по потокам.

SELECT 
	teacher_id, 
	AVG(grade) 
FROM grades WHERE teacher_id = 
	(SELECT id FROM teachers WHERE surname = 'Савельев' AND name = 'Николай');

4. Найдите потоки преподавателя Натальи Петровой, а также потоки, по которым успеваемость ниже 4.8. В отчёт выведите идентификатор потока, фамилию и имя преподавателя.

SELECT 
	stream_id, 
	(SELECT surname FROM teachers WHERE id = teacher_id) AS surname, 
	(SELECT name FROM teachers WHERE id = teacher_id) AS name
FROM grades WHERE teacher_id = (SELECT id FROM teachers WHERE surname = 'Петрова' AND name = 'Наталья')
UNION ALL
SELECT 
	stream_id, 
	(SELECT surname FROM teachers WHERE id = teacher_id) AS surname, 
	(SELECT name FROM teachers WHERE id = teacher_id) AS name
FROM grades WHERE grade >= 4.8;

5. Дополнительное задание. Найдите разницу между средней успеваемостью преподавателя с наивысшим соответствующим значением и средней успеваемостью преподавателя с наименьшим значением. Средняя успеваемость считается по всем потокам преподавателя.

SELECT 
(SELECT AVG(grade) AS max_average FROM grades GROUP BY teacher_id ORDER BY max_average DESC LIMIT 1) 
- 
(SELECT AVG(grade) AS min_average FROM grades GROUP BY teacher_id ORDER BY min_average LIMIT 1) 
AS difference;
